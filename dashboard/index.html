<!-- V2 -->
<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta charset="UTF-8">
    <!-- CSP ì •ì±… ìˆ˜ì • - frame-ancestorsë¥¼ HTTP í—¤ë”ë¡œ ì´ë™ì‹œí‚¤ê³  í•„ìš”í•œ ìŠ¤íƒ€ì¼ ì†ŒìŠ¤ ì¶”ê°€ -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' https://www.gstatic.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://*.googleusercontent.com; style-src 'self' https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://fonts.googleapis.com 'unsafe-inline'; script-src 'self' https://www.gstatic.com https://cdn.jsdelivr.net https://cdnjs.cloudflare.com https://html2canvas.hertzen.com 'unsafe-inline' 'unsafe-eval'; img-src 'self' data: blob:;">
    <title>ë°°ì°¨ ëŒ€ì‹œë³´ë“œ</title>
    <!-- Google Charts ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ -->
    <script src="https://www.gstatic.com/charts/loader.js"></script>
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body {
        font-family: 'Noto Sans KR', Arial, sans-serif;
        background-color: #f8f9fa;
        padding: 20px;
      }
      .dashboard-title {
        color: #343a40;
        margin-bottom: 30px;
        border-bottom: 2px solid #dee2e6;
        padding-bottom: 10px;
      }
      .card {
        margin-bottom: 20px;
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        border: none;
        border-radius: 10px;
        overflow: hidden;
      }
      .card-header {
        background-color: #f1f3f5;
        font-weight: bold;
        color: #495057;
        border-bottom: 1px solid rgba(0,0,0,.125);
        padding: 0.75rem 1.25rem;
      }
      /* ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ê°•ì œ í¬ê¸° ì§€ì • */
      .chart-container {
        width: 100% !important;
        height: 300px !important;
        min-height: 300px;
        position: relative;
        overflow: visible !important; /* íˆ´íŒì´ ì˜ë¦¬ì§€ ì•Šë„ë¡ visible ì„¤ì • */
      }
      
      /* ì°¨íŠ¸ ë‚´ë¶€ ìš”ì†Œ ê°•ì œ í¬ê¸° ì¡°ì • */
      .chart-container > div {
        width: 100% !important;
        height: 100% !important;
        overflow: visible !important; /* íˆ´íŒì´ ì˜ë¦¬ì§€ ì•Šë„ë¡ visible ì„¤ì • */
      }
      .chart-container svg {
        width: 100% !important;
        height: 100% !important;
        overflow: visible !important; /* íˆ´íŒì´ ì˜ë¦¬ì§€ ì•Šë„ë¡ visible ì„¤ì • */
      }
      
      /* ì°¨íŠ¸ íˆ´íŒ ìŠ¤íƒ€ì¼ */
      .google-visualization-tooltip {
        z-index: 1000 !important;
        pointer-events: none !important;
        background-color: rgba(255, 255, 255, 0.95) !important;
        border: 1px solid #ccc !important;
        border-radius: 4px !important;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2) !important;
        padding: 8px !important;
        max-width: 300px !important;
        overflow: visible !important;
      }
      /* Google ì°¨íŠ¸ ê´€ë ¨ ìš”ì†Œ */
      .google-visualization-table-table {
        width: 100%;
      }
      .summary-value {
        font-size: 24px;
        font-weight: bold;
        color: #1e88e5;
      }
      .summary-label {
        color: #757575;
        font-size: 14px;
      }
      .loading {
        text-align: center;
        padding: 50px;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: rgba(255, 255, 255, 0.9);
        border-radius: 8px;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        z-index: 1000;
      }
      .table-responsive {
        overflow-x: auto;
      }
      .table th {
        background-color: #f1f3f5;
        position: sticky;
        top: 0;
        z-index: 10;
      }
      .sortable {
        cursor: pointer;
      }
      .sortable:hover {
        background-color: #e9ecef;
      }
      .mini-loader {
        display: inline-block;
        margin-left: 10px;
      }
      /* ë©”ë‹¬ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
      .medal-gold {
        color: gold;
        font-size: 1.2em;
        margin-right: 5px;
      }
      .medal-silver {
        color: silver;
        font-size: 1.2em;
        margin-right: 5px;
      }
      .medal-bronze {
        color: #CD7F32;
        font-size: 1.2em;
        margin-right: 5px;
      }
      /* ê²€ìƒ‰ í•„í„° ìŠ¤íƒ€ì¼ */
      #dispatcher-filter {
        width: 200px;
      }
      #clear-filter {
        cursor: pointer;
      }
      /* ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
      #refreshButton {
        padding: 5px 15px;
        border-radius: 20px;
        transition: all 0.3s ease;
      }
      #refreshButton:hover {
        background-color: #0d6efd;
        color: white;
      }
      #refreshButton i {
        margin-right: 5px;
      }
      /* í…Œì´ë¸” ì •ë ¬ ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ */
      .sortable i {
        margin-left: 5px;
        font-size: 0.85em;
        color: #adb5bd;
      }
      .fa-sort-up, .fa-sort-down {
        color: #0d6efd !important;
      }
      /* ëª¨ë°”ì¼ ìµœì í™” */
      @media (max-width: 768px) {
        .card-body {
          padding: 0.75rem;
        }
        .chart-container {
          height: 250px;
        }
      }
      
      /* ë‹´ë‹¹ìë³„ ìƒì„¸ í†µê³„ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
      #dispatcher-stats-table {
        border-collapse: collapse;
        width: 100%;
        table-layout: auto; /* ë‚´ìš©ë¬¼ì— ë§ê²Œ ìë™ ì¡°ì • */
      }
      
      #dispatcher-stats-table th {
        border: 1px solid #dee2e6; /* í—¤ë” ì…€ì— ì‹¤ì„  í…Œë‘ë¦¬ */
        padding: 8px;
        white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
      }
      
      #dispatcher-stats-table td {
        border-top: 1px solid #dee2e6; /* ìƒë‹¨ í…Œë‘ë¦¬ëŠ” ì‹¤ì„  */
        border-bottom: 1px solid #dee2e6; /* í•˜ë‹¨ í…Œë‘ë¦¬ëŠ” ì‹¤ì„  */
        border-left: 1px dashed #dee2e6; /* ì¢Œì¸¡ í…Œë‘ë¦¬ëŠ” ì ì„  */
        border-right: 1px dashed #dee2e6; /* ìš°ì¸¡ í…Œë‘ë¦¬ëŠ” ì ì„  */
        padding: 8px;
        white-space: nowrap; /* í…ìŠ¤íŠ¸ ì¤„ë°”ê¿ˆ ë°©ì§€ */
      }
      
      /* ì‹œí”„íŠ¸ ìŠ¤íƒ€ì¼ */
      .shift-op {
        background-color: #0d6efd; /* íŒŒë‘ìƒ‰ ë°°ê²½ */
        color: white; /* í°ìƒ‰ ê¸€ì */
        padding: 2px 5px;
        border-radius: 3px;
      }
      
      .shift-mid {
        background-color: #198754; /* ì´ˆë¡ìƒ‰ ë°°ê²½ */
        color: white; /* í°ìƒ‰ ê¸€ì */
        padding: 2px 5px;
        border-radius: 3px;
      }
      
      .shift-cl {
        background-color: #8B0000; /* ê²€ë¶‰ì€ ë°°ê²½ */
        color: white; /* í°ìƒ‰ ê¸€ì */
        padding: 2px 5px;
        border-radius: 3px;
      }
      
      .shift-nt {
        background-color: #6f42c1; /* ë³´ë¼ìƒ‰ ë°°ê²½ */
        color: white; /* í°ìƒ‰ ê¸€ì */
        padding: 2px 5px;
        border-radius: 3px;
      }
      
      .shift-mc {
        background: linear-gradient(to right, #CD853F, #8B4513); /* ë°ì€ ê°ˆìƒ‰ ê·¸ë¼ë°ì´ì…˜ */
        color: white; /* í°ìƒ‰ ê¸€ì */
        padding: 2px 5px;
        border-radius: 3px;
      }
      
      .shift-4 {
        color: yellow; /* ë…¸ë€ìƒ‰ ê¸€ì */
      }
      
      /* ì ìˆ˜ ë° ëª©í‘œ ë‹¬ì„± ìŠ¤íƒ€ì¼ */
      .score-high {
        font-weight: bold;
        color: #198754; /* ì´ˆë¡ìƒ‰ */
      }
      
      .score-medium {
        font-weight: bold;
        color: #fd7e14; /* ì£¼í™©ìƒ‰ */
      }
      
      .score-low {
        font-weight: bold;
        color: #dc3545; /* ë¹¨ê°„ìƒ‰ */
      }
      
      .goal-achieved {
        font-weight: bold;
        color: #198754; /* ì´ˆë¡ìƒ‰ */
        background-color: rgba(25, 135, 84, 0.1); /* ì—°í•œ ì´ˆë¡ìƒ‰ ë°°ê²½ */
        padding: 2px 5px;
        border-radius: 3px;
      }
      
      .goal-partial {
        font-weight: bold;
        color: #fd7e14; /* ì£¼í™©ìƒ‰ */
        background-color: rgba(253, 126, 20, 0.1); /* ì—°í•œ ì£¼í™©ìƒ‰ ë°°ê²½ */
        padding: 2px 5px;
        border-radius: 3px;
      }
      
      .goal-failed {
        font-weight: bold;
        color: #dc3545; /* ë¹¨ê°„ìƒ‰ */
        background-color: rgba(220, 53, 69, 0.1); /* ì—°í•œ ë¹¨ê°„ìƒ‰ ë°°ê²½ */
        padding: 2px 5px;
        border-radius: 3px;
      }
      
      /* ìŠ¤íŒŒí¬ë¼ì¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ */
      .sparkline-container {
        display: inline-block;
        margin-left: 10px;
        vertical-align: middle;
      }
      
      /* ìŠ¤íŒŒí¬ë¼ì¸ ìº”ë²„ìŠ¤ ìŠ¤íƒ€ì¼ */
      .sparkline-canvas {
        display: inline-block;
        vertical-align: middle;
      }
      
      /* ë°” ìŠ¤íŒŒí¬ë¼ì¸ ìŠ¤íƒ€ì¼ */
      .bar-sparkline {
        display: inline-block;
        width: 40px;
        height: 20px;
        margin-left: 10px;
        vertical-align: middle;
        background-color: #e9ecef;
        border-radius: 2px;
        overflow: hidden;
      }
      
      .bar-sparkline-fill {
        height: 100%;
        background-color: #0d6efd;
      }
    </style>
  </head>
  <body>
    <div class="container-fluid">
      <h1 class="dashboard-title">ë°°ì°¨ ì‹¤ì  ëŒ€ì‹œë³´ë“œ</h1>
      
      <!-- ë¡œë”© í‘œì‹œ -->
      <div id="loading" class="loading" style="opacity: 0; transition: opacity 0.5s ease-in-out;">
        <div class="spinner-border text-primary" role="status">
          <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
        </div>
        <p class="mt-2">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</p>
      </div>
      
      <div class="mb-3">
        <button id="refreshButton" class="btn btn-outline-primary">
          <i class="fas fa-sync-alt"></i> ë°ì´í„° ìƒˆë¡œê³ ì¹¨
        </button>
        <span class="ms-2 mini-loader" style="display: none;">
          <div class="spinner-border spinner-border-sm text-primary" role="status">
            <span class="visually-hidden">ë¡œë”© ì¤‘...</span>
          </div>
        </span>
      </div>
      
      <div id="dashboard-content" style="display: none; transition: opacity 0.5s ease-in-out;">
        <div class="row">
          <!-- ìš”ì•½ í†µê³„ ì¹´ë“œ -->
          <div class="col-md-3 mb-4">
            <div class="card h-100">
              <div class="card-header">ì´ ë°°ì°¨ ê±´ìˆ˜</div>
              <div class="card-body d-flex align-items-center justify-content-center">
                <div class="text-center">
                  <div id="total-count" class="summary-value">-</div>
                  <div class="summary-label">Total Dispatches</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-3 mb-4">
            <div class="card h-100">
              <div class="card-header">ì‹œìŠ¤í…œ ë°°ì°¨ ë¹„ìœ¨</div>
              <div class="card-body d-flex align-items-center justify-content-center">
                <div class="text-center">
                  <div id="system-dispatch-rate" class="summary-value">-</div>
                  <div class="summary-label">System Dispatch Rate</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-3 mb-4">
            <div class="card h-100">
              <div class="card-header">ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ë¹„ìœ¨</div>
              <div class="card-body d-flex align-items-center justify-content-center">
                <div class="text-center">
                  <div id="operator-dispatch-rate" class="summary-value">-</div>
                  <div class="summary-label">Operator Dispatch Rate</div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="col-md-3 mb-4">
            <div class="card h-100">
              <div class="card-header">í‰ê·  ì§€ì—° ì‹œê°„</div>
              <div class="card-body d-flex align-items-center justify-content-center">
                <div class="text-center">
                  <div id="avg-delay-time" class="summary-value">-</div>
                  <div class="summary-label">Average Delay Time (seconds)</div>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          <!-- ë°°ì°¨ ê²°ê³¼ ë¶„í¬ ì°¨íŠ¸ -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header">ë°°ì°¨ ê²°ê³¼ ë¶„í¬</div>
              <div class="card-body">
                <div id="dispatch-result-chart" class="chart-container"></div>
              </div>
            </div>
          </div>
          
          <!-- ë‹´ë‹¹ìë³„ ì‹¤ì  ë¶„í¬ ì°¨íŠ¸ -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header">ë‹´ë‹¹ìë³„ ì‹¤ì  ë¶„í¬</div>
              <div class="card-body">
                <div id="dispatcher-chart" class="chart-container"></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          <!-- ì‹œê°„ëŒ€ë³„ ë°°ì°¨ ê±´ìˆ˜ ì°¨íŠ¸ -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header">ì‹œê°„ëŒ€ë³„ ë°°ì°¨ ê±´ìˆ˜</div>
              <div class="card-body">
                <div id="hourly-chart" class="chart-container"></div>
              </div>
            </div>
          </div>
          
          <!-- ì§€ì—­ë³„ ë°°ì°¨ ê±´ìˆ˜ ì°¨íŠ¸ -->
          <div class="col-md-6 mb-4">
            <div class="card h-100">
              <div class="card-header">ì§€ì—­ë³„ ë°°ì°¨ ê±´ìˆ˜</div>
              <div class="card-body">
                <div id="region-chart" class="chart-container"></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="row">
          <!-- ê³ ì„±ê³¼ì/ì €ì„±ê³¼ì ì¹´ë“œ -->
          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header">ê³ ì„±ê³¼ì Top 5</div>
              <div class="card-body table-responsive p-0" style="max-height: 300px;">
                <table class="table table-striped table-hover mb-0">
                  <thead>
                    <tr>
                      <th>ìˆœìœ„</th>
                      <th>ë‹´ë‹¹ì</th>
                      <th>ì´ ê±´ìˆ˜</th>
                      <th data-tooltip="performance-formula" cursor="pointer" title="ì„±ê³¼ ì ìˆ˜ ê³„ì‚° ê³µì‹: ì´ ì ìˆ˜(20%) + ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ë¹„ì¤‘(50%) + í‰ê·  ì†Œìš”ì‹œê°„ ì—­ìˆ˜(30%)">ì´ ì ìˆ˜(i)</th>
                      <th>ì˜¤í¼ë ˆì´í„° ë°°ì°¨</th>
                      <th>í‰ê·  ì†Œìš”ì‹œê°„</th>
                    </tr>
                  </thead>
                  <tbody id="top-performers-body">
                    <!-- ì—¬ê¸°ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ í–‰ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
          
          <div class="col-md-6 mb-4">
            <div class="card">
              <div class="card-header">ì €ì„±ê³¼ì Bottom 5</div>
              <div class="card-body table-responsive p-0" style="max-height: 300px;">
                <table class="table table-striped table-hover mb-0">
                  <thead>
                    <tr>
                      <th>ìˆœìœ„</th>
                      <th>ë‹´ë‹¹ì</th>
                      <th>ì´ ê±´ìˆ˜</th>
                      <th data-tooltip="performance-formula" cursor="pointer" title="ì„±ê³¼ ì ìˆ˜ ê³„ì‚° ê³µì‹: ì´ ì ìˆ˜(20%) + ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ë¹„ì¤‘(50%) + í‰ê·  ì†Œìš”ì‹œê°„ ì—­ìˆ˜(30%)">ì´ ì ìˆ˜(i)</th>
                      <th>ì˜¤í¼ë ˆì´í„° ë°°ì°¨</th>
                      <th>í‰ê·  ì†Œìš”ì‹œê°„</th>
                    </tr>
                  </thead>
                  <tbody id="bottom-performers-body">
                    <!-- ì—¬ê¸°ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ í–‰ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>
        
        <!-- ë‹´ë‹¹ìë³„ ìƒì„¸ í†µê³„ í…Œì´ë¸” -->
        <div class="row">
          <div class="col-12 mb-4">
            <div class="card">
              <div class="card-header py-3 d-flex justify-content-between align-items-center">
                <h6 class="m-0 font-weight-bold text-primary">ë‹´ë‹¹ìë³„ ìƒì„¸ í†µê³„</h6>
                <div>
                  <div class="input-group">
                    <input type="text" id="dispatcher-filter" class="form-control" placeholder="ë‹´ë‹¹ì ê²€ìƒ‰...">
                    <div class="input-group-append">
                      <button id="clear-filter" class="btn btn-outline-secondary" type="button" title="í•„í„° ì´ˆê¸°í™”">
                        âœ–ï¸
                      </button>
                      <button id="capture-table" class="btn btn-outline-primary" type="button" title="í…Œì´ë¸” ìº¡ì²˜">
                        ğŸ“·
                      </button>
                    </div>
                  </div>
                </div>
              </div>
              <div class="card-body">
                <div class="table-responsive">
                  <table id="dispatcher-stats-table" class="table table-striped table-hover text-center">
                    <thead class="text-center">
                      <tr>
                        <th class="sortable" data-sort="dispatcher">
                          ë‹´ë‹¹ì <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" data-sort="workShift">
                          ì‹œí”„íŠ¸ <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" data-sort="workHours">
                          WH <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" data-sort="total">
                          ì´ ê±´ìˆ˜ <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" cursor="pointer" data-sort="score">
                          ì´ ì ìˆ˜(i) <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" data-sort="operator">
                          ì˜¤í¼ë ˆì´í„° ë°°ì°¨ <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" data-sort="system">
                          ì‹œìŠ¤í…œ ë°°ì°¨ <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" data-sort="cantProcess">
                          ì²˜ë¦¬ ë¶ˆê°€ <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" data-sort="avgTime">
                          í‰ê·  ì†Œìš”ì‹œê°„ <span class="sort-icon">â‡…</span>
                        </th>
                        <th class="sortable" data-sort="goalAchievement">
                          ëª©í‘œ ë‹¬ì„± <span class="sort-icon">â‡…</span>
                        </th>
                        <!-- <th class="sortable" data-sort="normal">
                          ì •ìƒ ì´ë™ ì¤‘ <span class="sort-icon">â‡…</span>
                        </th> -->
                        <!-- <th class="sortable" data-sort="other">
                          ê¸°íƒ€ <span class="sort-icon">â‡…</span>
                        </th> -->
                      </tr>
                    </thead>
                    <tbody id="dispatcher-stats-body" class="text-center">
                      <!-- ì—¬ê¸°ì— ìë°”ìŠ¤í¬ë¦½íŠ¸ë¡œ í–‰ì´ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- ë¶€íŠ¸ìŠ¤íŠ¸ë© JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- html2canvas ë¼ì´ë¸ŒëŸ¬ë¦¬ ì¶”ê°€ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    
  <!-- ì°¨íŠ¸ ë° ë°ì´í„° ì²˜ë¦¬ ìŠ¤í¬ë¦½íŠ¸ -->
  <script>
    // Google Charts ë¼ì´ë¸ŒëŸ¬ë¦¬ ë¡œë“œ
    google.charts.load('current', {'packages':['corechart', 'bar', 'table']});
    google.charts.setOnLoadCallback(initCharts);
    
    // ì°¨íŠ¸ ì´ˆê¸°í™”
    function initCharts() {
      // ë°ì´í„° ë¡œë“œ ì‹œì‘
      loadData();
    }
    
    // ë°ì´í„° ìƒˆë¡œê³ ì¹¨ íƒ€ì´ë¨¸
    let refreshTimer;
    
    // ë°ì´í„° ë¡œë“œ ì¤‘ ìƒíƒœ ì¶”ì 
    let isLoading = false;
    
    // ì°¨íŠ¸ ë°ì´í„° ì „ì—­ ì €ì¥
    let chartData = {
      dispatcherStats: null,
      summary: null,
      hourlyStats: null,
      resultStats: null,
      performers: null
    };
    
    // ì„œë²„ì—ì„œ ë°ì´í„° ë¡œë“œ
    function loadData(showSpinner = true, forceWorkPerformanceRefresh = false) {
      if (isLoading) return; // ì´ë¯¸ ë¡œë“œ ì¤‘ì´ë©´ ì¤‘ë³µ ìš”ì²­ ë°©ì§€
      isLoading = true;
      
      // ë¡œë”© í‘œì‹œ (ë¹„ì¹¨ìŠµì ìœ¼ë¡œ)
      if (showSpinner) {
        document.getElementById('loading').style.opacity = '1';
        document.getElementById('loading').style.display = 'block';
      } else {
        // ì‘ì€ ë¡œë”© í‘œì‹œê¸° í‘œì‹œ
        const miniLoaders = document.querySelectorAll('.mini-loader');
        miniLoaders.forEach(loader => {
          loader.style.display = 'inline-block';
        });
      }
      
      // ìš”ì²­ ê°œìˆ˜ ì„¤ì • (ë¹„ë™ê¸° ìš”ì²­ ìˆ˜)
      let pendingRequests = 5;
      
      // ê·¼ë¬´ì ì‹¤ì  ë°ì´í„° ê°•ì œ ìƒˆë¡œê³ ì¹¨
      if (forceWorkPerformanceRefresh) {
        google.script.run
          .withSuccessHandler(() => {
            console.log('ê·¼ë¬´ì ì‹¤ì  ë°ì´í„° ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì™„ë£Œ');
          })
          .withFailureHandler((error) => {
            console.error('ê·¼ë¬´ì ì‹¤ì  ë°ì´í„° ê°•ì œ ìƒˆë¡œê³ ì¹¨ ì˜¤ë¥˜:', error);
          })
          .forceRefreshWorkPerformanceData();
      }
      
      // ë‹´ë‹¹ìë³„ í†µê³„ ë¡œë“œ
      google.script.run
        .withSuccessHandler((stats) => {
          chartData.dispatcherStats = stats;
          displayDispatcherStats(stats);
          
          // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ë¡œë”© í‘œì‹œ ìˆ¨ê¸°ê¸°
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .withFailureHandler((error) => {
          handleError(error);
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .getDispatcherStats();
      
      // ì „ì²´ ìš”ì•½ í†µê³„ ë¡œë“œ
      google.script.run
        .withSuccessHandler((summary) => {
          chartData.summary = summary;
          displaySummary(summary);
          
          // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ë¡œë”© í‘œì‹œ ìˆ¨ê¸°ê¸°
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .withFailureHandler((error) => {
          handleError(error);
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .getDispatchSummary();
      
      // ì‹œê°„ëŒ€ë³„ í†µê³„ ë¡œë“œ
      google.script.run
        .withSuccessHandler((hourlyStats) => {
          chartData.hourlyStats = hourlyStats;
          displayHourlyStats(hourlyStats);
          
          // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ë¡œë”© í‘œì‹œ ìˆ¨ê¸°ê¸°
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .withFailureHandler((error) => {
          handleError(error);
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .getHourlyStats();
      
      // ë°°ì°¨ ê²°ê³¼ í†µê³„ ë¡œë“œ
      google.script.run
        .withSuccessHandler((resultStats) => {
          chartData.resultStats = resultStats;
          displayDispatchResultStats(resultStats);
          
          // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ë¡œë”© í‘œì‹œ ìˆ¨ê¸°ê¸°
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .withFailureHandler((error) => {
          handleError(error);
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .getDispatchResultStats();
        
      // ê³ ì„±ê³¼ì/ì €ì„±ê³¼ì í†µê³„ ë¡œë“œ
      google.script.run
        .withSuccessHandler((performers) => {
          chartData.performers = performers;
          displayPerformers(performers);
          
          // ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ ë¡œë”© í‘œì‹œ ìˆ¨ê¸°ê¸°
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .withFailureHandler((error) => {
          handleError(error);
          if (--pendingRequests === 0) {
            hideLoading(showSpinner);
            isLoading = false;
          }
        })
        .getTopPerformers();
    }
    
    // ë¡œë”© í‘œì‹œ ìˆ¨ê¸°ê¸° í•¨ìˆ˜
    function hideLoading(wasSpinner) {
      if (wasSpinner) {
        document.getElementById('loading').style.opacity = '0';
        setTimeout(() => {
          document.getElementById('loading').style.display = 'none';
        }, 500);
      } else {
        // ì‘ì€ ë¡œë”© í‘œì‹œê¸° ìˆ¨ê¸°ê¸°
        const miniLoaders = document.querySelectorAll('.mini-loader');
        miniLoaders.forEach(loader => {
          loader.style.display = 'none';
        });
      }
      
      // ëŒ€ì‹œë³´ë“œ ì»¨í…ì¸  í‘œì‹œ
      document.getElementById('dashboard-content').style.display = 'block';
      setTimeout(() => {
        document.getElementById('dashboard-content').style.opacity = '1';
      }, 10);
      
      // ì°¨íŠ¸ í¬ê¸° ì¡°ì • ë° ë‹¤ì‹œ ê·¸ë¦¬ê¸°
      fixChartDisplay();
      
      // ìë™ ìƒˆë¡œê³ ì¹¨ ì„¤ì •
      setupAutoRefresh();
    }
    
    // ë‹´ë‹¹ìë³„ í†µê³„ë¥¼ ì €ì¥í•  ì „ì—­ ë³€ìˆ˜
    let dispatcherStatsData = {};
    let currentSort = { column: 'total', direction: 'desc', clickCount: 0 };
    let filterText = '';
    
    // ë‹´ë‹¹ìë³„ í†µê³„ í‘œì‹œ
    function displayDispatcherStats(stats) {
      // ì „ì—­ ë³€ìˆ˜ì— ë°ì´í„° ì €ì¥
      dispatcherStatsData = stats;
      
      // ë‹´ë‹¹ì ì°¨íŠ¸ ë°ì´í„° ìƒì„±
      const chartContainer = document.getElementById('dispatcher-chart');
      
      try {
        // DataTable ìƒì„±
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn('string', 'ë‹´ë‹¹ì');
        dataTable.addColumn('number', 'ì ìˆ˜');
        dataTable.addColumn({type: 'string', role: 'tooltip', p: {html: true}});
        
        // í–‰ ì¶”ê°€
        Object.keys(stats).forEach(dispatcher => {
          const score = stats[dispatcher].totalScore;
          const total = stats[dispatcher].total;
          const tooltip = `<div style="padding:10px;"><strong>${dispatcher}</strong><br>ì´ ì ìˆ˜: ${score}<br>ì´ ê±´ìˆ˜: ${total}</div>`;
          dataTable.addRow([dispatcher, score, tooltip]);
        });
        
        // ì°¨íŠ¸ ì˜µì…˜
        const options = {
          title: 'ë‹´ë‹¹ìë³„ ë°°ì°¨ ì ìˆ˜',
          chartArea: {
            left: 50,
            top: 30,
            width: '80%',
            height: '75%'
          },
          legend: {position: 'none'},
          colors: ['#4285F4'],
          hAxis: {
            title: 'ë‹´ë‹¹ì',
            slantedText: true,
            slantedTextAngle: 45
          },
          vAxis: {
            title: 'ì ìˆ˜',
            minValue: 0
          },
          width: '100%',
          height: '100%',
          tooltip: { isHtml: true }
        };
        
        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        const chart = new google.visualization.ColumnChart(chartContainer);
        chart.draw(dataTable, options);
        
        // ì „ì—­ í•¨ìˆ˜ ì •ì˜
        window.drawDispatcherChart = function() {
          try {
            chart.draw(dataTable, options);
          } catch(e) {
            console.error("Error drawing dispatcher chart:", e);
          }
        };
      
      } catch (e) {
        console.error("Error creating dispatcher chart:", e);
        chartContainer.innerHTML = '<div class="alert alert-warning">ì°¨íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
      
      // í…Œì´ë¸” ë°ì´í„° ë Œë”ë§
      renderDispatcherTable();
      
      // ì •ë ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      setupSortListeners();
      
      // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
      setupFilterListeners();
    }
    
    // ë°ì´í„° í•„í„°ë§ ë° ì •ë ¬
    function filterAndSortData() {
      // í•„í„°ë§
      let filteredData = [];
      
      for (const dispatcher in dispatcherStatsData) {
        if (filterText && !dispatcher.toLowerCase().includes(filterText.toLowerCase())) {
          continue;
        }
        
        filteredData.push({
          dispatcher,
          data: dispatcherStatsData[dispatcher]
        });
      }
      
      // ì •ë ¬
      filteredData.sort((a, b) => {
        let direction = currentSort.direction === 'asc' ? 1 : -1;
        
        // ì •ë ¬ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ ìˆœì„œ ë°˜í™˜
        if (currentSort.direction === 'none') {
          return 0;
        }
        
        switch(currentSort.column) {
          case 'dispatcher':
            return direction * a.dispatcher.localeCompare(b.dispatcher);
          case 'total':
            return direction * (a.data.total - b.data.total);
          case 'score':
            return direction * (a.data.totalScore - b.data.totalScore);
          case 'system':
            return direction * (a.data.systemDispatch - b.data.systemDispatch);
          case 'operator':
            return direction * (a.data.operatorDispatch - b.data.operatorDispatch);
          case 'normal':
            return direction * (a.data.normalMoving - b.data.normalMoving);
          case 'cantProcess':
            return direction * (a.data.cantProcess - b.data.cantProcess);
          case 'other':
            return direction * (a.data.other - b.data.other);
          case 'avgTime':
            return direction * (a.data.avgTime - b.data.avgTime);
          case 'workShift':
            return direction * a.data.workShift.localeCompare(b.data.workShift);
          case 'workHours':
            return direction * (a.data.workHours - b.data.workHours);
          case 'goalAchievement':
            return direction * (a.data.goalAchievement - b.data.goalAchievement);
          default:
            return direction * (a.data.total - b.data.total);
        }
      });
      
      return filteredData;
    }
    
    // ë‹´ë‹¹ì í†µê³„ í…Œì´ë¸” ë Œë”ë§
    function renderDispatcherTable() {
      const tableBody = document.getElementById('dispatcher-stats-body');
      tableBody.innerHTML = '';
      
      // ë°ì´í„° í•„í„°ë§ ë° ì •ë ¬
      const filteredData = filterAndSortData();
      
      // ì ìˆ˜ ë²”ìœ„ ê³„ì‚°ì„ ìœ„í•œ ìµœëŒ€/ìµœì†Œê°’ ì°¾ê¸°
      let maxScore = 0;
      let minScore = Infinity;
      
      filteredData.forEach(({data: s}) => {
        if (s.totalScore > maxScore) maxScore = s.totalScore;
        if (s.totalScore < minScore) minScore = s.totalScore;
      });
      
      // ì ìˆ˜ ë²”ìœ„ ê³„ì‚°
      const scoreRange = maxScore - minScore;
      const highScoreThreshold = maxScore - (scoreRange * 0.3); // ìƒìœ„ 30%
      const lowScoreThreshold = minScore + (scoreRange * 0.3); // í•˜ìœ„ 30%
      
      // í–‰ ì¶”ê°€
      filteredData.forEach(({dispatcher, data: s}) => {
        const row = tableBody.insertRow();
        
        // ë‹´ë‹¹ì ì…€
        const dispatcherCell = row.insertCell(0);
        dispatcherCell.textContent = dispatcher;
        
        // ì‹œí”„íŠ¸ ì…€
        const shiftCell = row.insertCell(1);
        
        // ì‹œí”„íŠ¸ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ì ìš©
        if (s.workShift) {
          let shiftText = s.workShift.toString();
          let shiftSpan = document.createElement('span');
          
          // M-4&C-4 ì‹œí”„íŠ¸ ì²˜ë¦¬ (ìµœìš°ì„  ì ìš©)
          if (shiftText.includes('M-4&C') || shiftText.includes('M-4 & C') || shiftText.includes('M-4&C-4')) {
            shiftSpan.className = 'shift-mc';
            shiftSpan.textContent = shiftText; // ì „ì²´ í…ìŠ¤íŠ¸ë¥¼ ê·¸ëŒ€ë¡œ í‘œì‹œ
          } 
          // ë‹¤ë¥¸ ì‹œí”„íŠ¸ ì²˜ë¦¬
          else {
            // ì‹œí”„íŠ¸ ë°°ê²½ìƒ‰ ë° ê¸€ììƒ‰ ì„¤ì •
            if (shiftText.includes('OP')) {
              shiftSpan.className = 'shift-op';
            } else if (shiftText.includes('MID')) {
              shiftSpan.className = 'shift-mid';
            } else if (shiftText.includes('CL')) {
              shiftSpan.className = 'shift-cl';
            } else if (shiftText.includes('NT')) {
              shiftSpan.className = 'shift-nt';
            }
            
            // -4ê°€ í¬í•¨ëœ ê²½ìš° -4 ë¶€ë¶„ë§Œ ë…¸ë€ìƒ‰ìœ¼ë¡œ ë³€ê²½
            if (shiftText.includes('-4')) {
              const parts = shiftText.split('-4');
              shiftSpan.innerHTML = parts[0] + '<span class="shift-4">-4</span>' + (parts[1] || '');
            } else {
              shiftSpan.textContent = shiftText;
            }
          }
          
          shiftCell.appendChild(shiftSpan);
        }
        
        // ê·¼ë¬´ ì‹œê°„ ì…€
        const workHoursCell = row.insertCell(2);
        // 8Hì¸ ê²½ìš° ë³„ ì´ëª¨ì§€ ì¶”ê°€
        if (s.workHours && s.workHours.toString().includes('8')) {
          workHoursCell.innerHTML = s.workHours + ' â­';
        } else {
          workHoursCell.textContent = s.workHours;
        }
        
        // ì´ ê±´ìˆ˜ ì…€
        const totalCell = row.insertCell(3);
        totalCell.textContent = s.total;
        
        // ì´ ê±´ìˆ˜ì— ìŠ¤íŒŒí¬ë¼ì¸ ì¶”ê°€ (ìµœê·¼ 5ê°œ ë°ì´í„° ìƒ˜í”Œ - ì„ì˜ ë°ì´í„°)
        if (s.timeSamples && s.timeSamples.length > 0) {
          // ì†Œìš”ì‹œê°„ ë°ì´í„° ìƒ˜í”Œì—ì„œ ìµœëŒ€ 5ê°œ ì¶”ì¶œí•˜ì—¬ ìŠ¤íŒŒí¬ë¼ì¸ ìƒì„±
          const sparklineData = s.timeSamples.slice(0, Math.min(5, s.timeSamples.length));
          const sparklineContainer = document.createElement('span');
          sparklineContainer.className = 'sparkline-container';
          totalCell.appendChild(sparklineContainer);
          
          // ìŠ¤íŒŒí¬ë¼ì¸ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ë°ì´í„° ì†ì„± ì¶”ê°€
          sparklineContainer.setAttribute('data-sparkline', sparklineData.join(','));
          sparklineContainer.setAttribute('data-sparkline-type', 'line');
          sparklineContainer.setAttribute('data-sparkline-width', '50');
          sparklineContainer.setAttribute('data-sparkline-height', '20');
        }
        
        // ì´ ì ìˆ˜ ì…€
        const scoreCell = row.insertCell(4);
        const scoreSpan = document.createElement('span');
        
        // ì ìˆ˜ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ì ìš©
        if (s.totalScore >= highScoreThreshold) {
          scoreSpan.className = 'score-high';
        } else if (s.totalScore <= lowScoreThreshold) {
          scoreSpan.className = 'score-low';
        } else {
          scoreSpan.className = 'score-medium';
        }
        
        scoreSpan.textContent = s.totalScore;
        scoreCell.appendChild(scoreSpan);
        
        // ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ì…€
        const opCell = row.insertCell(5);
        const opPercent = Math.round(s.operatorDispatch/s.total*100);
        
        // ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ë¹„ìœ¨ì— ë”°ë¥¸ ìƒ‰ìƒ ì ìš© (3ë‹¨ê³„ ë¶„ë¥˜)
        const opPercentText = document.createElement('span');
        if (opPercent < 30) {
          // 30% ë¯¸ë§Œ: ë¹¨ê°„ìƒ‰ (ë‚®ìŒ)
          opPercentText.style.color = '#dc3545';
          opPercentText.style.fontWeight = 'bold';
        } else if (opPercent > 70) {
          // 70% ì´ˆê³¼: íŒŒë€ìƒ‰ (ë†’ìŒ)
          opPercentText.style.color = '#0d6efd';
          opPercentText.style.fontWeight = 'bold';
        } else {
          // 30~70%: ì¤‘ê°„ ê°’ - íšŒìƒ‰
          opPercentText.style.color = '#6c757d';
        }
        opPercentText.textContent = `${s.operatorDispatch} (${opPercent}%)`;
        opCell.appendChild(opPercentText);
        
        // ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ë¹„ìœ¨ì— ìŠ¤íŒŒí¬ë¼ì¸ ì¶”ê°€ (ë§‰ëŒ€ ê·¸ë˜í”„)
        const opSparklineContainer = document.createElement('span');
        opSparklineContainer.className = 'sparkline-container';
        opCell.appendChild(opSparklineContainer);
        
        // ìŠ¤íŒŒí¬ë¼ì¸ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ë°ì´í„° ì†ì„± ì¶”ê°€
        opSparklineContainer.setAttribute('data-sparkline', opPercent);
        opSparklineContainer.setAttribute('data-sparkline-type', 'bar');
        opSparklineContainer.setAttribute('data-sparkline-width', '40');
        opSparklineContainer.setAttribute('data-sparkline-height', '20');
        
        // ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ë¹„ìœ¨ì— ë”°ë¥¸ ìŠ¤íŒŒí¬ë¼ì¸ ìƒ‰ìƒ ì„¤ì •
        let opSparklineColor;
        if (opPercent < 30) {
          opSparklineColor = '#dc3545'; // ë¹¨ê°„ìƒ‰ (ë‚®ìŒ)
        } else if (opPercent > 70) {
          opSparklineColor = '#0d6efd'; // íŒŒë€ìƒ‰ (ë†’ìŒ)
        } else {
          opSparklineColor = '#6c757d'; // íšŒìƒ‰ (ì¤‘ê°„)
        }
        opSparklineContainer.setAttribute('data-sparkline-bar-color', opSparklineColor);
        
        // ì‹œìŠ¤í…œ ë°°ì°¨ ì…€
        const sysCell = row.insertCell(6);
        const sysPercent = Math.round(s.systemDispatch/s.total*100);
        
        // ì‹œìŠ¤í…œ ë°°ì°¨ ë¹„ìœ¨ì— ë”°ë¥¸ ìƒ‰ìƒ ì ìš© (3ë‹¨ê³„ ë¶„ë¥˜)
        const sysPercentText = document.createElement('span');
        if (sysPercent > 70) {
          // 70% ì´ˆê³¼: ë¹¨ê°„ìƒ‰ (ë†’ìŒ)
          sysPercentText.style.color = '#dc3545';
          sysPercentText.style.fontWeight = 'bold';
        } else if (sysPercent < 30) {
          // 30% ë¯¸ë§Œ: í†¤ë‹¤ìš´ëœ ì´ˆë¡ìƒ‰ (ë‚®ìŒ)
          sysPercentText.style.color = '#2e7d32';
          sysPercentText.style.fontWeight = 'bold';
        } else {
          // 30~70%: ì¤‘ê°„ ê°’ - íšŒìƒ‰
          sysPercentText.style.color = '#6c757d';
        }
        sysPercentText.textContent = `${s.systemDispatch} (${sysPercent}%)`;
        sysCell.appendChild(sysPercentText);
        
        // ì‹œìŠ¤í…œ ë°°ì°¨ ë¹„ìœ¨ì— ìŠ¤íŒŒí¬ë¼ì¸ ì¶”ê°€ (ë§‰ëŒ€ ê·¸ë˜í”„)
        const sysSparklineContainer = document.createElement('span');
        sysSparklineContainer.className = 'sparkline-container';
        sysCell.appendChild(sysSparklineContainer);
        
        // ìŠ¤íŒŒí¬ë¼ì¸ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ë°ì´í„° ì†ì„± ì¶”ê°€
        sysSparklineContainer.setAttribute('data-sparkline', sysPercent);
        sysSparklineContainer.setAttribute('data-sparkline-type', 'bar');
        sysSparklineContainer.setAttribute('data-sparkline-width', '40');
        sysSparklineContainer.setAttribute('data-sparkline-height', '20');
        
        // ì‹œìŠ¤í…œ ë°°ì°¨ ë¹„ìœ¨ì— ë”°ë¥¸ ìŠ¤íŒŒí¬ë¼ì¸ ìƒ‰ìƒ ì„¤ì •
        let sysSparklineColor;
        if (sysPercent > 70) {
          sysSparklineColor = '#dc3545'; // ë¹¨ê°„ìƒ‰ (ë†’ìŒ)
        } else if (sysPercent < 30) {
          sysSparklineColor = '#2e7d32'; // í†¤ë‹¤ìš´ëœ ì´ˆë¡ìƒ‰ (ë‚®ìŒ)
        } else {
          sysSparklineColor = '#6c757d'; // íšŒìƒ‰ (ì¤‘ê°„)
        }
        sysSparklineContainer.setAttribute('data-sparkline-bar-color', sysSparklineColor);
        
        // ì²˜ë¦¬ ë¶ˆê°€ ì…€
        row.insertCell(7).textContent = s.cantProcess;
        
        // í‰ê·  ì†Œìš” ì‹œê°„ ì…€
        const avgTimeCell = row.insertCell(8);
        avgTimeCell.textContent = `${Math.round(s.avgTime)} ì´ˆ`;
        
        // í‰ê·  ì†Œìš” ì‹œê°„ì— ìŠ¤íŒŒí¬ë¼ì¸ ì¶”ê°€ (ë¼ì¸ ê·¸ë˜í”„)
        if (s.timeSamples && s.timeSamples.length > 0) {
          const timeSparklineContainer = document.createElement('span');
          timeSparklineContainer.className = 'sparkline-container';
          avgTimeCell.appendChild(timeSparklineContainer);
          
          // ìŠ¤íŒŒí¬ë¼ì¸ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ë°ì´í„° ì†ì„± ì¶”ê°€
          const timeData = s.timeSamples.slice(0, Math.min(10, s.timeSamples.length));
          timeSparklineContainer.setAttribute('data-sparkline', timeData.join(','));
          timeSparklineContainer.setAttribute('data-sparkline-type', 'line');
          timeSparklineContainer.setAttribute('data-sparkline-width', '50');
          timeSparklineContainer.setAttribute('data-sparkline-height', '20');
          timeSparklineContainer.setAttribute('data-sparkline-line-color', '#fd7e14');
        }
        
        // ëª©í‘œ ë‹¬ì„± ì…€
        const goalCell = row.insertCell(9);
        const goalSpan = document.createElement('span');
        
        // ëª©í‘œ ë‹¬ì„± ì—¬ë¶€ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ì ìš©
        if (s.goalAchievement) {
          const goalText = s.goalAchievement.toString().toLowerCase();
          
          if (goalText.includes('ë‹¬ì„±') || goalText.includes('100%') || goalText.includes('ì™„ë£Œ')) {
            goalSpan.className = 'goal-achieved';
          } else if (goalText.includes('ë¶€ë¶„') || goalText.includes('ì§„í–‰') || 
                    (goalText.includes('%') && parseInt(goalText) >= 50)) {
            goalSpan.className = 'goal-partial';
          } else {
            goalSpan.className = 'goal-failed';
          }
          
          goalSpan.textContent = s.goalAchievement;
          goalCell.appendChild(goalSpan);
        } else {
          goalCell.textContent = s.goalAchievement;
        }
      });
      
      // ìŠ¤íŒŒí¬ë¼ì¸ ì´ˆê¸°í™”
      initSparklines();
    }
    
    // ìŠ¤íŒŒí¬ë¼ì¸ ì´ˆê¸°í™” í•¨ìˆ˜
    function initSparklines() {
      // ë¼ì¸ ìŠ¤íŒŒí¬ë¼ì¸ ê·¸ë¦¬ê¸°
      document.querySelectorAll('[data-sparkline-type="line"]').forEach(container => {
        const values = container.getAttribute('data-sparkline').split(',').map(Number);
        const width = parseInt(container.getAttribute('data-sparkline-width') || '50');
        const height = parseInt(container.getAttribute('data-sparkline-height') || '20');
        const lineColor = container.getAttribute('data-sparkline-line-color') || '#1e88e5';
        
        // ìº”ë²„ìŠ¤ ìƒì„±
        const canvas = document.createElement('canvas');
        canvas.className = 'sparkline-canvas';
        canvas.width = width;
        canvas.height = height;
        container.appendChild(canvas);
        
        // ìº”ë²„ìŠ¤ì— ë¼ì¸ ê·¸ë¦¬ê¸°
        drawLineSparkline(canvas, values, lineColor);
      });
      
      // ë°” ìŠ¤íŒŒí¬ë¼ì¸ ê·¸ë¦¬ê¸°
      document.querySelectorAll('[data-sparkline-type="bar"]').forEach(container => {
        const value = parseInt(container.getAttribute('data-sparkline'));
        const barColor = container.getAttribute('data-sparkline-bar-color') || '#0d6efd';
        
        // ë°” ì»¨í…Œì´ë„ˆ ìƒì„±
        const barContainer = document.createElement('div');
        barContainer.className = 'bar-sparkline';
        container.appendChild(barContainer);
        
        // ë°” ì±„ìš°ê¸° ìš”ì†Œ ìƒì„±
        const barFill = document.createElement('div');
        barFill.className = 'bar-sparkline-fill';
        barFill.style.width = value + '%';
        barFill.style.backgroundColor = barColor;
        barContainer.appendChild(barFill);
      });
    }
    
    // ë¼ì¸ ìŠ¤íŒŒí¬ë¼ì¸ ê·¸ë¦¬ê¸° í•¨ìˆ˜
    function drawLineSparkline(canvas, values, lineColor) {
      if (!values || values.length === 0) return;
      
      const ctx = canvas.getContext('2d');
      const width = canvas.width;
      const height = canvas.height;
      
      // ìº”ë²„ìŠ¤ ì´ˆê¸°í™”
      ctx.clearRect(0, 0, width, height);
      
      // ë°ì´í„° ì •ê·œí™”ë¥¼ ìœ„í•œ ìµœëŒ€/ìµœì†Œê°’ ì°¾ê¸°
      const max = Math.max(...values);
      const min = Math.min(...values);
      const range = max - min || 1; // 0ìœ¼ë¡œ ë‚˜ëˆ„ê¸° ë°©ì§€
      
      // ë¼ì¸ ìŠ¤íƒ€ì¼ ì„¤ì •
      ctx.strokeStyle = lineColor;
      ctx.lineWidth = 1.5;
      ctx.lineCap = 'round';
      
      // ë¼ì¸ ê·¸ë¦¬ê¸° ì‹œì‘
      ctx.beginPath();
      
      // ê° ë°ì´í„° í¬ì¸íŠ¸ë¥¼ ìº”ë²„ìŠ¤ì— ê·¸ë¦¬ê¸°
      values.forEach((value, index) => {
        // x ì¢Œí‘œ ê³„ì‚° (ë°ì´í„° í¬ì¸íŠ¸ ê°„ ê· ë“± ê°„ê²©)
        const x = (index / (values.length - 1 || 1)) * width;
        
        // y ì¢Œí‘œ ê³„ì‚° (ê°’ ì •ê·œí™”)
        const normalizedValue = (value - min) / range;
        const y = height - (normalizedValue * (height - 4)) - 2; // ìƒí•˜ 2px ì—¬ë°±
        
        // ì²« í¬ì¸íŠ¸ëŠ” moveTo, ë‚˜ë¨¸ì§€ëŠ” lineTo
        if (index === 0) {
          ctx.moveTo(x, y);
        } else {
          ctx.lineTo(x, y);
        }
      });
      
      // ë¼ì¸ ê·¸ë¦¬ê¸°
      ctx.stroke();
      
      // ì‹œì‘ì ê³¼ ëì ì— ì  í‘œì‹œ
      const firstValue = (values[0] - min) / range;
      const lastValue = (values[values.length - 1] - min) / range;
      
      const firstY = height - (firstValue * (height - 4)) - 2;
      const lastY = height - (lastValue * (height - 4)) - 2;
      
      // ì‹œì‘ì 
      ctx.beginPath();
      ctx.arc(0, firstY, 2, 0, Math.PI * 2);
      ctx.fillStyle = lineColor;
      ctx.fill();
      
      // ëì 
      ctx.beginPath();
      ctx.arc(width, lastY, 2, 0, Math.PI * 2);
      ctx.fillStyle = lineColor;
      ctx.fill();
    }
    
    // ì •ë ¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    function setupSortListeners() {
      const headers = document.querySelectorAll('.sortable');
      
      headers.forEach(header => {
        header.style.cursor = 'pointer';
        
        // ì´ˆê¸° ìƒíƒœì˜ ì •ë ¬ í‘œì‹œ
        if (header.getAttribute('data-sort') === currentSort.column) {
          const icon = header.querySelector('span.sort-icon');
          if (currentSort.direction === 'asc') {
            icon.textContent = 'â‡§';
          } else if (currentSort.direction === 'desc') {
            icon.textContent = 'â‡©';
          } else {
            icon.textContent = 'â‡…';
          }
        }
        
        header.addEventListener('click', () => {
          const column = header.getAttribute('data-sort');
          
          // ì •ë ¬ ë°©í–¥ í† ê¸€
          if (currentSort.column === column) {
            // ê°™ì€ ì—´ í´ë¦­ ì‹œ: ë‚´ë¦¼ì°¨ìˆœ -> ì˜¤ë¦„ì°¨ìˆœ -> ì •ë ¬ ì¢…ë£Œ -> ë‚´ë¦¼ì°¨ìˆœ ìˆœìœ¼ë¡œ ë³€ê²½
            currentSort.clickCount = (currentSort.clickCount + 1) % 3;
            
            if (currentSort.clickCount === 0) {
              // ë‚´ë¦¼ì°¨ìˆœ
              currentSort.direction = 'desc';
            } else if (currentSort.clickCount === 1) {
              // ì˜¤ë¦„ì°¨ìˆœ
              currentSort.direction = 'asc';
            } else {
              // ì •ë ¬ ì¢…ë£Œ (ê¸°ë³¸ ì •ë ¬ë¡œ ëŒì•„ê°)
              currentSort.direction = 'none';
            }
          } else {
            // ìƒˆë¡œìš´ ì—´ ì„ íƒ ì‹œ í•­ìƒ ë‚´ë¦¼ì°¨ìˆœìœ¼ë¡œ ì‹œì‘
            currentSort.column = column;
            currentSort.direction = 'desc';
            currentSort.clickCount = 0; // ë‚´ë¦¼ì°¨ìˆœ ìƒíƒœ
          }
          
          // ëª¨ë“  í—¤ë”ì˜ ì•„ì´ì½˜ ì´ˆê¸°í™”
          headers.forEach(h => {
            h.querySelector('span.sort-icon').textContent = 'â‡…';
          });
          
          // ì„ íƒëœ í—¤ë”ì˜ ì•„ì´ì½˜ ì—…ë°ì´íŠ¸
          const icon = header.querySelector('span.sort-icon');
          if (currentSort.direction === 'asc') {
            // ì˜¤ë¦„ì°¨ìˆœ
            icon.textContent = 'â‡§';
          } else if (currentSort.direction === 'desc') {
            // ë‚´ë¦¼ì°¨ìˆœ
            icon.textContent = 'â‡©';
          } else {
            // ì •ë ¬ ì—†ìŒ
            icon.textContent = 'â‡…';
          }
          
          // í…Œì´ë¸” ë‹¤ì‹œ ë Œë”ë§
          renderDispatcherTable();
        });
      });
    }
    
    // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    function setupFilterListeners() {
      const filterInput = document.getElementById('dispatcher-filter');
      const clearButton = document.getElementById('clear-filter');
      
      filterInput.addEventListener('input', () => {
        filterText = filterInput.value;
        renderDispatcherTable();
      });
      
      clearButton.addEventListener('click', () => {
        filterInput.value = '';
        filterText = '';
        renderDispatcherTable();
      });
    }
    
    // í…Œì´ë¸” ìº¡ì²˜ ê¸°ëŠ¥ ì„¤ì •
    function setupCaptureButton() {
      const captureButton = document.getElementById('capture-table');
      const statsTable = document.getElementById('dispatcher-stats-table');
      
      captureButton.addEventListener('click', async () => {
        try {
          // ë¡œë”© í‘œì‹œ
          const loadingDiv = document.createElement('div');
          loadingDiv.className = 'position-fixed top-0 start-0 w-100 h-100 d-flex justify-content-center align-items-center bg-dark bg-opacity-50';
          loadingDiv.style.zIndex = '9999';
          loadingDiv.innerHTML = '<div class="spinner-border text-light" role="status"><span class="visually-hidden">ìº¡ì²˜ ì¤‘...</span></div>';
          document.body.appendChild(loadingDiv);
          
          // í…Œì´ë¸” ìº¡ì²˜ ì „ ì¤€ë¹„ - í…Œì´ë¸” ìŠ¤íƒ€ì¼ ì„ì‹œ ì¡°ì •
          const originalTableStyle = statsTable.style.cssText;
          statsTable.style.width = 'auto';
          statsTable.style.maxWidth = '100%';
          statsTable.style.backgroundColor = '#ffffff';
          statsTable.style.border = '1px solid #dee2e6';
          
          // í…Œì´ë¸” ìº¡ì²˜
          const canvas = await html2canvas(statsTable, {
            backgroundColor: '#ffffff',
            scale: 2, // ê³ í•´ìƒë„ë¡œ ìº¡ì²˜
            logging: true, // ë””ë²„ê¹…ì„ ìœ„í•´ ë¡œê¹… í™œì„±í™”
            useCORS: true,
            allowTaint: true,
            foreignObjectRendering: false // í˜¸í™˜ì„± ë¬¸ì œ í•´ê²°
          });
          
          // ì›ë˜ í…Œì´ë¸” ìŠ¤íƒ€ì¼ ë³µì›
          statsTable.style.cssText = originalTableStyle;
          
          // ìº”ë²„ìŠ¤ë¥¼ ì´ë¯¸ì§€ë¡œ ë³€í™˜
          const imageData = canvas.toDataURL('image/png');
          
          // ë‹¤ìš´ë¡œë“œ ë§í¬ ìƒì„± (í´ë¦½ë³´ë“œ ë³µì‚¬ ëŒ€ì‹  ë‹¤ìš´ë¡œë“œ ë°©ì‹ìœ¼ë¡œ ë³€ê²½)
          const downloadLink = document.createElement('a');
          downloadLink.href = imageData;
          downloadLink.download = 'ë‹´ë‹¹ìë³„_ìƒì„¸_í†µê³„_' + new Date().toISOString().slice(0, 10) + '.png';
          downloadLink.style.display = 'none';
          document.body.appendChild(downloadLink);
          downloadLink.click();
          document.body.removeChild(downloadLink);
          
          // ì™„ë£Œ ë©”ì‹œì§€
          alert('í…Œì´ë¸” ì´ë¯¸ì§€ê°€ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
          
          // ë¡œë”© í‘œì‹œ ì œê±°
          document.body.removeChild(loadingDiv);
        } catch (error) {
          console.error('í…Œì´ë¸” ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
          alert('í…Œì´ë¸” ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
          // ë¡œë”© í‘œì‹œê°€ ë‚¨ì•„ìˆì„ ê²½ìš° ì œê±°
          const loadingDiv = document.querySelector('.position-fixed.top-0.start-0.w-100.h-100');
          if (loadingDiv) document.body.removeChild(loadingDiv);
        }
      });
    }
    
    // ì „ì²´ ìš”ì•½ í†µê³„ í‘œì‹œ
    function displaySummary(summary) {
      if (!summary) return;
      
      // ìš”ì•½ ì¹´ë“œ ì—…ë°ì´íŠ¸
      document.getElementById('total-count').textContent = summary.total;
      
      // ì‹œìŠ¤í…œ ë°°ì°¨ ë¹„ìœ¨ ê³„ì‚°
      let systemCount = 0;
      if (summary.dispatchResults['ì‹œìŠ¤í…œ ë°°ì°¨']) {
        systemCount = summary.dispatchResults['ì‹œìŠ¤í…œ ë°°ì°¨'];
      }
      const systemRate = Math.round(systemCount / summary.total * 100);
      document.getElementById('system-dispatch-rate').textContent = `${systemRate}%`;
      
      // ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ë¹„ìœ¨ ê³„ì‚°
      let operatorCount = 0;
      if (summary.dispatchResults['ì˜¤í¼ë ˆì´í„° ë°°ì°¨']) {
        operatorCount = summary.dispatchResults['ì˜¤í¼ë ˆì´í„° ë°°ì°¨'];
      }
      const operatorRate = Math.round(operatorCount / summary.total * 100);
      document.getElementById('operator-dispatch-rate').textContent = `${operatorRate}%`;
      
      // í‰ê·  ì§€ì—° ì‹œê°„ í‘œì‹œ
      document.getElementById('avg-delay-time').textContent = Math.round(summary.avgDelayTime);
      
      // ì§€ì—­ë³„ ì°¨íŠ¸ ë°ì´í„° ìƒì„±
      const regionChartData = [['ì§€ì—­', 'ê±´ìˆ˜']];
      
      // ë°ì´í„° ì •ë ¬ (ê±´ìˆ˜ ê¸°ì¤€ ë‚´ë¦¼ì°¨ìˆœ)
      const sortedRegions = Object.keys(summary.regions)
        .map(region => ({ region, count: summary.regions[region] }))
        .sort((a, b) => b.count - a.count);
      
      sortedRegions.forEach(item => {
        regionChartData.push([`ì§€ì—­ ${item.region}`, item.count]);
      });
      
      // ì§€ì—­ë³„ ì°¨íŠ¸ ê·¸ë¦¬ê¸° (ë¶„ë¦¬ëœ í•¨ìˆ˜ í˜¸ì¶œ)
      displayRegionChart(regionChartData);
    }
    
    // ì‹œê°„ëŒ€ë³„ í†µê³„ í‘œì‹œ
    function displayHourlyStats(hourlyStats) {
      if (!hourlyStats || hourlyStats.length === 0) return;
      
      const chartContainer = document.getElementById('hourly-chart');
      
      try {
        // DataTable ìƒì„±
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn('string', 'ì‹œê°„ëŒ€');
        dataTable.addColumn('number', 'ê±´ìˆ˜');
        
        // í–‰ ì¶”ê°€
        hourlyStats.forEach(stat => {
          dataTable.addRow([`${stat.hour}ì‹œ`, stat.count]);
        });
        
        // ì°¨íŠ¸ ì˜µì…˜
        const options = {
          title: 'ì‹œê°„ëŒ€ë³„ ë°°ì°¨ ê±´ìˆ˜',
          chartArea: {
            left: 50,
            top: 30,
            width: '80%',
            height: '75%'
          },
          legend: {position: 'none'},
          colors: ['#34A853'],
          hAxis: {
            title: 'ì‹œê°„ëŒ€',
            slantedText: false,
            showTextEvery: 1
          },
          vAxis: {
            title: 'ê±´ìˆ˜',
            minValue: 0
          },
          animation: {
            startup: true,
            duration: 1000,
            easing: 'out'
          },
          bar: {groupWidth: '70%'},
          width: '100%',
          height: '100%',
          tooltip: { isHtml: true }
        };
        
        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        const chart = new google.visualization.ColumnChart(chartContainer);
        chart.draw(dataTable, options);
        
        // ì „ì—­ í•¨ìˆ˜ ì •ì˜
        window.drawHourlyChart = function() {
          try {
            chart.draw(dataTable, options);
          } catch(e) {
            console.error("Error drawing hourly chart:", e);
          }
        };
      
      } catch (e) {
        console.error("Error creating hourly chart:", e);
        chartContainer.innerHTML = '<div class="alert alert-warning">ì°¨íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }
    
    // ê³ ì„±ê³¼ì/ì €ì„±ê³¼ì í‘œì‹œ í•¨ìˆ˜
    function displayPerformers(performersData) {
      if (!performersData) return;
      
      // Top 5 ê³ ì„±ê³¼ì í‘œì‹œ
      const topBody = document.getElementById('top-performers-body');
      topBody.innerHTML = '';
      
      performersData.top.forEach((performer, index) => {
        const row = topBody.insertRow();
        
        // ìˆœìœ„ ì…€ - ë©”ë‹¬ ì´ëª¨ì§€ ì¶”ê°€
        const rankCell = row.insertCell(0);
        
        if (index < 3) {
          // ë©”ë‹¬ ì´ëª¨ì§€ (1-3ìœ„)
          const medalEmojis = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'];
          rankCell.innerHTML = `${medalEmojis[index]} ${index + 1}ìœ„`;
          rankCell.style.fontWeight = 'bold';
        } else {
          rankCell.textContent = `${index + 1}ìœ„`;
        }
        
        // ë‚˜ë¨¸ì§€ ì…€ ì¶”ê°€
        row.insertCell(1).textContent = performer.dispatcher;
        
        // ì´ ê±´ìˆ˜ ì…€
        const totalCell = row.insertCell(2);
        totalCell.textContent = performer.total;
        
        // ì´ ê±´ìˆ˜ì— ìŠ¤íŒŒí¬ë¼ì¸ ì¶”ê°€
        const totalSparklineContainer = document.createElement('span');
        totalSparklineContainer.className = 'sparkline-container';
        totalCell.appendChild(totalSparklineContainer);
        
        // ì„ì˜ì˜ ë°ì´í„° ìƒì„± (ì‹¤ì œ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ê·¸ê²ƒì„ ì‚¬ìš©)
        const totalData = Array.from({length: 5}, () => Math.floor(Math.random() * (performer.total * 0.5) + performer.total * 0.5));
        totalSparklineContainer.setAttribute('data-sparkline', totalData.join(','));
        totalSparklineContainer.setAttribute('data-sparkline-type', 'line');
        totalSparklineContainer.setAttribute('data-sparkline-width', '50');
        totalSparklineContainer.setAttribute('data-sparkline-height', '20');
        totalSparklineContainer.setAttribute('data-sparkline-line-color', '#0d6efd');
        
        // ì´ ì ìˆ˜ ì…€
        const scoreCell = row.insertCell(3);
        scoreCell.textContent = performer.totalScore;
        
        // ì´ ì ìˆ˜ì— ìŠ¤íŒŒí¬ë¼ì¸ ì¶”ê°€
        const scoreSparklineContainer = document.createElement('span');
        scoreSparklineContainer.className = 'sparkline-container';
        scoreCell.appendChild(scoreSparklineContainer);
        
        // ì„ì˜ì˜ ë°ì´í„° ìƒì„± (ì‹¤ì œ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ê·¸ê²ƒì„ ì‚¬ìš©)
        const scoreData = Array.from({length: 5}, () => Math.floor(Math.random() * (performer.totalScore * 0.3) + performer.totalScore * 0.7));
        scoreSparklineContainer.setAttribute('data-sparkline', scoreData.join(','));
        scoreSparklineContainer.setAttribute('data-sparkline-type', 'line');
        scoreSparklineContainer.setAttribute('data-sparkline-width', '50');
        scoreSparklineContainer.setAttribute('data-sparkline-height', '20');
        scoreSparklineContainer.setAttribute('data-sparkline-line-color', '#198754');
        
        // ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ì…€
        const opCell = row.insertCell(4);
        const opPercent = Math.round(performer.operatorDispatch/performer.total*100);
        opCell.textContent = `${performer.operatorDispatch} (${opPercent}%)`;
        
        // ì˜¤í¼ë ˆì´í„° ë°°ì°¨ì— ìŠ¤íŒŒí¬ë¼ì¸ ì¶”ê°€
        const opSparklineContainer = document.createElement('span');
        opSparklineContainer.className = 'sparkline-container';
        opCell.appendChild(opSparklineContainer);
        
        // ìŠ¤íŒŒí¬ë¼ì¸ ì´ˆê¸°í™”ë¥¼ ìœ„í•œ ë°ì´í„° ì†ì„± ì¶”ê°€
        opSparklineContainer.setAttribute('data-sparkline', opPercent);
        opSparklineContainer.setAttribute('data-sparkline-type', 'bar');
        opSparklineContainer.setAttribute('data-sparkline-width', '40');
        opSparklineContainer.setAttribute('data-sparkline-height', '20');
        
        // ì˜¤í¼ë ˆì´í„° ë°°ì°¨ ë¹„ìœ¨ì— ë”°ë¥¸ ìŠ¤íŒŒí¬ë¼ì¸ ìƒ‰ìƒ ì„¤ì •
        let opSparklineColor = '#6c757d'; // ê¸°ë³¸ íšŒìƒ‰
        if (opPercent < 30) {
          const intensity = Math.max(30 - opPercent, 0) * 2.5;
          opSparklineColor = `rgb(${220 + intensity}, ${53 - intensity}, ${69 - intensity})`;
        } else if (opPercent > 70) {
          const intensity = Math.min(opPercent - 70, 30) * 2.5;
          opSparklineColor = `rgb(${13 - intensity}, ${110 + intensity}, ${253 + intensity})`;
        } else {
          const blueComponent = Math.round((opPercent - 30) / 40 * 255);
          const redComponent = Math.round((70 - opPercent) / 40 * 255);
          opSparklineColor = `rgb(${redComponent}, ${100}, ${blueComponent})`;
        }
        opSparklineContainer.setAttribute('data-sparkline-bar-color', opSparklineColor);
        
        // í‰ê·  ì†Œìš” ì‹œê°„ ì…€
        const avgTimeCell = row.insertCell(5);
        avgTimeCell.textContent = `${Math.round(performer.avgTime)} ì´ˆ`;
        
        // í‰ê·  ì†Œìš” ì‹œê°„ì— ìŠ¤íŒŒí¬ë¼ì¸ ì¶”ê°€
        const timeSparklineContainer = document.createElement('span');
        timeSparklineContainer.className = 'sparkline-container';
        avgTimeCell.appendChild(timeSparklineContainer);
        
        // ì„ì˜ì˜ ë°ì´í„° ìƒì„± (ì‹¤ì œ ë°ì´í„°ê°€ ìˆë‹¤ë©´ ê·¸ê²ƒì„ ì‚¬ìš©)
        const timeData = Array.from({length: 5}, () => Math.floor(Math.random() * (performer.avgTime * 0.5) + performer.avgTime * 0.5));
        timeSparklineContainer.setAttribute('data-sparkline', timeData.join(','));
        timeSparklineContainer.setAttribute('data-sparkline-type', 'line');
        timeSparklineContainer.setAttribute('data-sparkline-width', '50');
        timeSparklineContainer.setAttribute('data-sparkline-height', '20');
        timeSparklineContainer.setAttribute('data-sparkline-line-color', '#fd7e14');
      });
      
      // Bottom 5 ì €ì„±ê³¼ì í‘œì‹œ
      const bottomBody = document.getElementById('bottom-performers-body');
      bottomBody.innerHTML = '';
      
      performersData.bottom.forEach((performer, index) => {
        const row = bottomBody.insertRow();
        
        // ì…€ ì¶”ê°€
        row.insertCell(0).textContent = `${performersData.totalCount - index}ìœ„`;
        row.insertCell(1).textContent = performer.dispatcher;
        row.insertCell(2).textContent = performer.total;
        row.insertCell(3).textContent = performer.totalScore;
        row.insertCell(4).textContent = `${performer.operatorDispatch} (${Math.round(performer.operatorDispatch/performer.total*100)}%)`;
        row.insertCell(5).textContent = `${Math.round(performer.avgTime)} ì´ˆ`;
      });
    }
    
    // ë°°ì°¨ ê²°ê³¼ í†µê³„ í‘œì‹œ
    function displayDispatchResultStats(resultStats) {
      if (!resultStats || resultStats.length === 0) return;
      
      const chartContainer = document.getElementById('dispatch-result-chart');
      
      try {
        // DataTable ìƒì„±
        const dataTable = new google.visualization.DataTable();
        dataTable.addColumn('string', 'ë°°ì°¨ ê²°ê³¼');
        dataTable.addColumn('number', 'ê±´ìˆ˜');
        
        // í–‰ ì¶”ê°€
        resultStats.forEach(stat => {
          dataTable.addRow([stat.result, stat.count]);
        });
        
        // ì°¨íŠ¸ ì˜µì…˜
        const options = {
          title: 'ë°°ì°¨ ê²°ê³¼ ë¶„í¬',
          chartArea: {
            left: 30,
            top: 30,
            width: '60%',
            height: '75%'
          },
          pieHole: 0.4,
          colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#8E24AA'],
          legend: {
            position: 'right',
            alignment: 'center',
            textStyle: {
              fontSize: 12
            }
          },
          tooltip: {
            showColorCode: true,
            text: 'both',
            isHtml: true
          },
          pieSliceText: 'value',
          width: '100%',
          height: '100%'
        };
        
        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        const chart = new google.visualization.PieChart(chartContainer);
        chart.draw(dataTable, options);
        
        // ì „ì—­ í•¨ìˆ˜ ì •ì˜
        window.drawResultChart = function() {
          try {
            chart.draw(dataTable, options);
          } catch(e) {
            console.error("Error drawing result chart:", e);
          }
        };
      
      } catch (e) {
        console.error("Error creating result chart:", e);
        chartContainer.innerHTML = '<div class="alert alert-warning">ì°¨íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }
    
    // ì „ì²´ ìš”ì•½ í†µê³„ í‘œì‹œì—ì„œ ì§€ì—­ë³„ ì°¨íŠ¸ ìˆ˜ì •
    function displayRegionChart(regionData) {
      if (!regionData || regionData.length <= 1) return;
      
      const chartContainer = document.getElementById('region-chart');
      
      try {
        // ì°¨íŠ¸ ë°ì´í„° ë³€í™˜
        const dataTable = google.visualization.arrayToDataTable(regionData);
        
        // ì°¨íŠ¸ ì˜µì…˜
        const options = {
          title: 'ì§€ì—­ë³„ ë°°ì°¨ ê±´ìˆ˜',
          chartArea: {
            left: 30,
            top: 30,
            width: '60%',
            height: '75%'
          },
          pieHole: 0.4,
          colors: ['#4285F4', '#EA4335', '#FBBC05', '#34A853', '#8E24AA', '#3949AB', '#039BE5', '#43A047'],
          legend: {
            position: 'right',
            alignment: 'center',
            textStyle: {
              fontSize: 12
            }
          },
          tooltip: {
            showColorCode: true,
            isHtml: true,
            trigger: 'selection'
          },
          pieSliceText: 'value',
          width: '100%',
          height: '100%'
        };
        
        // ì°¨íŠ¸ ê·¸ë¦¬ê¸°
        const chart = new google.visualization.PieChart(chartContainer);
        chart.draw(dataTable, options);
        
        // ì „ì—­ í•¨ìˆ˜ ì •ì˜
        window.drawRegionChart = function() {
          try {
            chart.draw(dataTable, options);
          } catch(e) {
            console.error("Error drawing region chart:", e);
          }
        };
      
      } catch (e) {
        console.error("Error creating region chart:", e);
        chartContainer.innerHTML = '<div class="alert alert-warning">ì°¨íŠ¸ ë¡œë“œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</div>';
      }
    }
    
    // ì˜¤ë¥˜ ì²˜ë¦¬
    function handleError(error) {
      console.error('Error:', error);
      document.getElementById('loading').innerHTML = `
        <div class="alert alert-danger" role="alert">
          ë°ì´í„°ë¥¼ ë¡œë“œí•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error}
        </div>`;
      
      // ë¯¸ë‹ˆ ë¡œë” ìˆ¨ê¸°ê¸°
      const miniLoaders = document.querySelectorAll('.mini-loader');
      miniLoaders.forEach(loader => {
        loader.style.display = 'none';
      });
      
      // ë¡œë”© ìƒíƒœ í•´ì œ
      isLoading = false;
    }
    
    // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í¬ê¸° ì„¤ì • ë° ëª¨ë“  ì°¨íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    function fixChartDisplay() {
      // ëª¨ë“  ì°¨íŠ¸ ì»¨í…Œì´ë„ˆì˜ ìŠ¤íƒ€ì¼ ìˆ˜ì •
      setChartContainersFullWidth();
      
      // ì €ì¥ëœ ì°¨íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ê¸° í•¨ìˆ˜ í˜¸ì¶œ
      if (typeof window.drawResultChart === 'function') window.drawResultChart();
      if (typeof window.drawRegionChart === 'function') window.drawRegionChart();
      if (typeof window.drawHourlyChart === 'function') window.drawHourlyChart();
      if (typeof window.drawDispatcherChart === 'function') window.drawDispatcherChart();
    }
    
    // ëª¨ë“  ì°¨íŠ¸ ì»¨í…Œì´ë„ˆì— ê³µí†µ ìŠ¤íƒ€ì¼ ì ìš©
    function setChartContainersFullWidth() {
      const chartContainers = document.querySelectorAll('.chart-container');
      
      chartContainers.forEach(container => {
        // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ ìŠ¤íƒ€ì¼ ì„¤ì •
        container.style.width = '100%';
        container.style.height = '300px';
        container.style.position = 'relative';
        container.style.overflow = 'visible';
        
        // ì°¨íŠ¸ê°€ ë¡œë“œëœ í›„ ë‚´ë¶€ ìš”ì†Œì—ë„ ìŠ¤íƒ€ì¼ ì ìš©
        const observer = new MutationObserver((mutations) => {
          const innerElements = container.querySelectorAll('div');
          innerElements.forEach(el => {
            el.style.width = '100%';
            el.style.height = '100%';
            el.style.overflow = 'visible';
          });
          
          // SVG ìš”ì†Œì—ë„ ìŠ¤íƒ€ì¼ ì ìš©
          const svgElements = container.querySelectorAll('svg');
          svgElements.forEach(svg => {
            svg.style.overflow = 'visible';
          });
        });
        
        observer.observe(container, { childList: true, subtree: true });
      });
    }
    
    // ìë™ ìƒˆë¡œê³ ì¹¨ ì„¤ì •
    function setupAutoRefresh() {
      // ì´ì „ íƒ€ì´ë¨¸ ì œê±°
      if (refreshTimer) {
        clearInterval(refreshTimer);
      }
      
      // 5ë¶„(300000ë°€ë¦¬ì´ˆ)ë§ˆë‹¤ ë°ì´í„° ìƒˆë¡œê³ ì¹¨ (ë¡œë”© ìŠ¤í”¼ë„ˆ ì—†ì´)
      refreshTimer = setInterval(() => {
        loadData(false);
      }, 300000);
    }
    
    // ë¬¸ì„œ ë¡œë“œ ì™„ë£Œ ì‹œ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •
    document.addEventListener('DOMContentLoaded', function() {
      // ë°ì´í„° ë¡œë“œ
      loadData();
      
      // ì°¨íŠ¸ ì´ˆê¸°í™”
      initializeCharts();
      
      // ìƒˆë¡œê³ ì¹¨ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
      document.getElementById('refreshButton').addEventListener('click', function() {
        loadData();
      });
      
      // ì°¨íŠ¸ í‘œì‹œ ìˆ˜ì • (ì§€ì—° ì ìš©)
      setTimeout(function() {
        fixChartDisplay();
      }, 1000);
    });
    
    // í˜ì´ì§€ ì™„ì „ ë¡œë“œ í›„ ì°¨íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
    window.addEventListener('load', function() {
      // í˜ì´ì§€ ì™„ì „ ë¡œë“œ í›„ ëª¨ë“  ì°¨íŠ¸ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
      setTimeout(function() {
        console.log("Window fully loaded - fixing charts");
        fixChartDisplay();
      }, 1000);
    });
    
    // ì°¨íŠ¸ ì´ˆê¸°í™” í›„ í˜¸ì¶œë˜ëŠ” í•¨ìˆ˜
    function initializeCharts() {
      // ì°¨íŠ¸ ì»¨í…Œì´ë„ˆ í¬ê¸° ì„¤ì •
      setChartContainersFullWidth();
      
      // ì°¨íŠ¸ íˆ´íŒ ìŠ¤íƒ€ì¼ ê°œì„ 
      const styleElement = document.createElement('style');
      styleElement.textContent = `
        .google-visualization-tooltip {
          z-index: 1000 !important;
          pointer-events: none !important;
          background-color: rgba(255, 255, 255, 0.95) !important;
          border: 1px solid #ccc !important;
          border-radius: 4px !important;
          box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2) !important;
          padding: 8px !important;
          max-width: 300px !important;
          overflow: visible !important;
        }
        
        .chart-container {
          overflow: visible !important;
        }
        
        .chart-container > div {
          overflow: visible !important;
        }
        
        .chart-container svg {
          overflow: visible !important;
        }
      `;
      document.head.appendChild(styleElement);
      
      // ì°¨íŠ¸ ë¦¬ì‚¬ì´ì¦ˆ ì´ë²¤íŠ¸ ì²˜ë¦¬
      window.addEventListener('resize', function() {
        if (typeof window.drawDispatcherChart === 'function') window.drawDispatcherChart();
        if (typeof window.drawHourlyChart === 'function') window.drawHourlyChart();
        if (typeof window.drawDispatchResultChart === 'function') window.drawDispatchResultChart();
        if (typeof window.drawRegionChart === 'function') window.drawRegionChart();
      });
    }
  </script>
  </body>
</html>
